/*! 2017-08-18 11:27:23 */

angular.module("region-selector",["ngSanitize","xom.shared"]),angular.module("region-selector").controller("RegionSelectorCtrl",["$scope","$timeout","eventBusSvc","INITIAL_COUNTRY","REGIONS","TOPO_URL",function(a,b,c,d,e,f){"use strict";function g(a){h(a)}function h(b){if(b){var c=i(b);-1!==c&&(a.currentRegionIndex=c)}}function i(b){for(var c=0;c<a.regions.length;c++)if(j(a.regions[c],b))return c;return-1}function j(a,b){return a.countries.filter(function(a){return a.code===b}).length>0}a.currentRegionIndex=-1,a.regions=e,a.worldMapConfig={activeItem:null,maxWidth:1e3,popupTemplate:'<h3>{{name}}</h3><div ng-repeat="line in lines"><span>{{line.name}}</span><p class="paragraph small"><span ng-repeat="s in line.sites"><span ng-show="$index > 0"> | </span><a ng-href="{{s.url}}" target="{{s.newWindow ? \'_blank\' : \'_self\'}}">{{s.name}}</a></span></p></div>',topoUrl:f},a.selectCountry=g,d&&b(function(){g(d)},500)}]),function(a){a("script[data-app]").each(function(){var b=a(this),c=b.data("app"),d=a.parseJSON(b.html());for(var e in d)angular.module(c).constant(e,d[e])})}(window.jQuery),angular.module("xom.shared",[]),function(a){"use strict";angular.module("xom.shared").directive("accordionTrigger",["$timeout",function(b){function c(a,c){b(function(){a.control=c})}function d(a){a.find('a[data-toggle="collapse"]').first().trigger("click")}return{restrict:"A",scope:{control:"=accordionTrigger"},link:function(b,e){e.parent().on("show.bs.collapse",".panel-group",function(d){var e=a(d.target).closest(".panel").index();c(b,e)}).on("hide.bs.collapse",".panel-group",function(a){c(b,-1)}),b.$watch("control",function(a){if(angular.isDefined(a)&&!(a<0)){var b=e.find(".panel").eq(a);b.hasClass("active")||d(b)}})}}}])}(window.jQuery),function(a,b){angular.module("xom.shared").directive("worldMap",["$compile","$timeout","REGIONS","ZOOM",function(c,d,e,f){var g=500,h=938,i=750,j={window:.8,max:4};return{restrict:"E",replace:!0,scope:{config:"="},template:'<div class="world-map-container world-map-regions" ng-click="onContainerClick()"><div class="world-map"><div class="world-map-label"></div><div class="world-map-popover-target"></div><div class="world-map-popover-content hidden"></div></div></div>',link:function(k,l){function m(){var a=o(!1);$.append("g").attr("class","regions").selectAll("path").data(a).enter().append("path").attr("class",w).attr("data-name",x).attr("d",Y).on("click",J)}function n(){var a=o(!0);$.append("g").attr("class","regions-zoom").selectAll("path").data(a).enter().append("path").attr("data-name",x).attr("d",Y)}function o(a){for(var b=[],c=0;c<e.length;c++){var d=u(e[c],a),f=topojson.merge(Q,Q.objects.countries.geometries.filter(d));f.region=e[c],b.push(f)}return b}function p(b){var c=function(a){return b.include.indexOf(a.id)>-1},d=a.extend(!0,{},Q);d.objects.countries.geometries=d.objects.countries.geometries.filter(c);var e=topojson.feature(d,d.objects.countries).features;$.append("g").attr("class","countries").selectAll("path").data(e).enter().append("path").attr("d",Y).attr("class",y).attr("code",z).on("mouseenter",M).on("mousemove",N).on("mouseleave",P).on("click",O)}function q(){Z.selectAll(".countries,.country-labels").remove()}function r(){a("body > .popover").remove(),V.popover("destroy")}function s(a,b,c){V.data("bs.popover",null),V.css({left:b,top:c}),V.popover({container:"body",content:B(a),html:"true",trigger:"manual","white-space":"nowrap"}),V.popover("show")}function t(){var a=v();Z.attr("width",a).attr("height",a*g/h),r()}function u(a,b){return function(c){return a.include.indexOf(c.id)>-1&&(!b||R[c.id])}}function v(){return Math.min(parseInt(k.config.maxWidth||1600),S.width())}function w(a){return"region "+(a.region.countries.length?"supported":"unsupported")}function x(a){return a.region.name}function y(a){return"country "+(C(a.id)?"supported":"unsupported")}function z(a){return a.id}function A(a){var b=R[a.id];return b?b.name:null}function B(a){var b=R[a.id];if(!b)return null;var d=k.$new(!0);angular.extend(d,b);var e='<div class="world-map-popover">'+k.config.popupTemplate+"</div>",f=c(e)(d);return U.empty().append(f),d.$apply(),U.html()}function C(a){return Object.keys(R).indexOf(a)>-1}function D(a){var b=f||j,c=Y.bounds(a),d=(c[1][0]-c[0][0])/h,e=(c[1][1]-c[0][1])/g,i=Math.min(b.max,b.window/Math.max(d,e));return[(c[1][0]+c[0][0])/2,(c[1][1]+c[0][1])/2+g/i/6,i]}function E(a){G(D(a),a)}function F(){G([h/2,g/1.5,1])}function G(a,b){var c=void 0!==b;$.transition().duration(i).attr("transform","translate("+X.translate()+")scale("+a[2]+")translate(-"+a[0]+",-"+a[1]+")").selectAll([".countries"]).style("stroke-width",1/a[2]+"px"),c?d(function(){S.addClass("country-mode")},i):S.removeClass("country-mode")}function H(a){return r(),a&&a!==k.config.activeItem&&(a.region||C(a.id))?k.config.activeItem=a:(k.config.activeItem=null,q(),F()),$.selectAll("path, .country-labels g").classed("active",L),k.config.activeItem===a}function I(){H()}function J(a){b.event.stopPropagation(),K(a)}function K(a){H(a)&&(p(a.region),E(b.select('.regions-zoom [data-name="'+a.region.name+'"]').datum()))}function L(a){return k.config.activeItem&&a.id&&a.id===k.config.activeItem.id}function M(a){if(k.config.activeItem!==a){var b=A(a);T.text(b).addClass("active"),T.data("height",T.outerHeight()),T.data("width",T.outerWidth())}}function N(a){var c=b.event.layerX-T.data("width")-5,d=b.event.layerY-T.data("height")-5;T.css({left:c,top:d})}function O(a){b.event.stopPropagation(),H(a)&&s(a,b.event.layerX-V.width()/2,b.event.layerY-V.width()/2)}function P(a){T.removeClass("active")}var Q,R=function(){for(var a={},b=0;b<e.length;b++)for(var c=0;c<e[b].countries.length;c++){var d=e[b].countries[c];a[d.code]=d}return a}(),S=a(l.find(".world-map")),T=S.find(".world-map-label"),U=S.find(".world-map-popover-content"),V=S.find(".world-map-popover-target"),W=v(),X=b.geo.mercator().scale(150).translate([h/2,g/1.5]),Y=b.geo.path().projection(X),Z=b.select(S[0]).append("svg").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 "+h+" "+g).attr("width",W).attr("height",W*g/h);Z.append("rect").attr("class","water").attr("width",h).attr("height",g).on("click",I);var $=Z.append("g");k.onContainerClick=I,b.json(k.config.topoUrl,function(a,b){if(a)throw a;Q=b,n(),m()}),a(window).resize(t)}}}])}(window.jQuery,window.d3),function(a){"use strict";angular.module("xom.shared").factory("eventBusSvc",function(){return{publish:a.publish,subscribe:a.subscribe}})}(window.jQuery);