/*! 2016-07-29 09:46:51 */
angular.module("region-selector",["ngSanitize","xom.shared"]),angular.module("region-selector").controller("RegionSelectorCtrl",["$scope","$timeout","eventBusSvc","INITIAL_COUNTRY","REGIONS","TOPO_URL",function(a,b,c,d,e,f){"use strict";function g(a){h(a)}function h(b){if(b){var c=i(b);-1!==c&&(a.currentRegionIndex=c)}}function i(b){for(var c=0;c<a.regions.length;c++)if(j(a.regions[c],b))return c;return-1}function j(a,b){return a.countries.filter(function(a){return a.code===b}).length>0}a.currentRegionIndex=-1,a.regions=e,a.worldMapConfig={activeItem:null,maxWidth:1e3,popupTemplate:'<h3>{{name}}</h3><div ng-repeat="line in lines"><span>{{line.name}}</span><p class="paragraph small"><span ng-repeat="s in line.sites"><span ng-show="$index > 0"> | </span><a ng-href="{{s.url}}" target="{{s.newWindow ? \'_blank\' : \'_self\'}}">{{s.name}}</a></span></p></div>',topoUrl:f},a.selectCountry=g,d&&b(function(){g(d)},500)}]),function(a){a("script[data-app]").each(function(){var b=a(this),c=b.data("app"),d=a.parseJSON(b.html());for(var e in d)angular.module(c).constant(e,d[e])})}(window.jQuery),angular.module("xom.shared",[]),function(a){"use strict";angular.module("xom.shared").directive("accordionTrigger",["$timeout",function(b){function c(a,c){b(function(){a.control=c})}function d(a){a.find('a[data-toggle="collapse"]').first().trigger("click")}return{restrict:"A",scope:{control:"=accordionTrigger"},link:function(b,e){e.parent().on("show.bs.collapse",".panel-group",function(d){var e=a(d.target).closest(".panel").index();c(b,e)}).on("hide.bs.collapse",".panel-group",function(a){c(b,-1)}),b.$watch("control",function(a){if(angular.isDefined(a)&&!(0>a)){var b=e.find(".panel").eq(a);b.hasClass("active")||d(b)}})}}}])}(window.jQuery),function(a,b){angular.module("xom.shared").directive("worldMap",["$compile","$timeout","REGIONS","ZOOM",function(c,d,e,f){var g=500,h=938,i=750,j=150,k={window:.8,max:4},l=5,m=5;return{restrict:"E",replace:!0,scope:{config:"="},template:'<div class="world-map-container world-map-regions" ng-click="onContainerClick()"><div class="world-map"><div class="world-map-label"></div><div class="world-map-popover-target"></div><div class="world-map-popover-content hidden"></div></div></div>',link:function(n,o){function p(){var a=r(!1);ca.append("g").attr("class","regions").selectAll("path").data(a).enter().append("path").attr("class",z).attr("data-name",A).attr("d",aa).on("click",M)}function q(){var a=r(!0);ca.append("g").attr("class","regions-zoom").selectAll("path").data(a).enter().append("path").attr("data-name",A).attr("d",aa)}function r(a){for(var b=[],c=0;c<e.length;c++){var d=x(e[c],a),f=topojson.merge(U,U.objects.countries.geometries.filter(d));f.region=e[c],b.push(f)}return b}function s(b){var c=function(a){return b.include.indexOf(a.id)>-1},d=a.extend(!0,{},U);d.objects.countries.geometries=d.objects.countries.geometries.filter(c);var e=topojson.feature(d,d.objects.countries).features;ca.append("g").attr("class","countries").selectAll("path").data(e).enter().append("path").attr("d",aa).attr("class",B).attr("code",C).on("mouseenter",P).on("mousemove",Q).on("mouseleave",S).on("click",R)}function t(){ba.selectAll(".countries,.country-labels").remove()}function u(){a("body > .popover").remove(),Z.popover("destroy")}function v(a,b,c){Z.data("bs.popover",null),Z.css({left:b,top:c}),Z.popover({container:"body",content:E(a),html:"true",trigger:"manual","white-space":"nowrap"}),Z.popover("show")}function w(){var a=y();ba.attr("width",a).attr("height",a*g/h),u()}function x(a,b){return function(c){return a.include.indexOf(c.id)>-1&&(!b||V[c.id])}}function y(){return Math.min(parseInt(n.config.maxWidth||1600),W.width())}function z(a){return"region "+(a.region.countries.length?"supported":"unsupported")}function A(a){return a.region.name}function B(a){return"country "+(F(a.id)?"supported":"unsupported")}function C(a){return a.id}function D(a){var b=V[a.id];return b?b.name:null}function E(a){var b=V[a.id];if(!b)return null;var d=n.$new(!0);angular.extend(d,b);var e='<div class="world-map-popover">'+n.config.popupTemplate+"</div>",f=c(e)(d);return Y.empty().append(f),d.$apply(),Y.html()}function F(a){return Object.keys(V).indexOf(a)>-1}function G(a){var b=f||k,c=aa.bounds(a),d=(c[1][0]-c[0][0])/h,e=(c[1][1]-c[0][1])/g,i=Math.min(b.max,b.window/Math.max(d,e)),j=(c[1][0]+c[0][0])/2,l=(c[1][1]+c[0][1])/2+g/i/6;return[j,l,i]}function H(a){var b=G(a);J(b,a)}function I(){var a=[h/2,g/1.5,1];J(a)}function J(a,b){var c=void 0!==b;ca.transition().duration(i).attr("transform","translate("+_.translate()+")scale("+a[2]+")translate(-"+a[0]+",-"+a[1]+")").selectAll([".countries"]).style("stroke-width",1/a[2]+"px"),c?d(function(){W.addClass("country-mode")},i):W.removeClass("country-mode")}function K(a){return u(),a&&a!==n.config.activeItem&&(a.region||F(a.id))?n.config.activeItem=a:(n.config.activeItem=null,t(),I()),ca.selectAll("path, .country-labels g").classed("active",O),n.config.activeItem===a}function L(){K()}function M(a){b.event.stopPropagation(),N(a)}function N(a){if(K(a)){s(a.region);var c=b.select('.regions-zoom [data-name="'+a.region.name+'"]').datum();H(c)}}function O(a){return n.config.activeItem&&a.id&&a.id===n.config.activeItem.id}function P(a){if(n.config.activeItem!==a){var b=D(a);X.text(b).addClass("active"),X.data("height",X.outerHeight()),X.data("width",X.outerWidth())}}function Q(a){var c=b.event.layerX-X.data("width")-l,d=b.event.layerY-X.data("height")-m;X.css({left:c,top:d})}function R(a){if(b.event.stopPropagation(),K(a)){var c=b.event.layerX-Z.width()/2,d=b.event.layerY-Z.width()/2;v(a,c,d)}}function S(a){X.removeClass("active")}function T(){for(var a={},b=0;b<e.length;b++)for(var c=0;c<e[b].countries.length;c++){var d=e[b].countries[c];a[d.code]=d}return a}var U,V=T(),W=a(o.find(".world-map")),X=W.find(".world-map-label"),Y=W.find(".world-map-popover-content"),Z=W.find(".world-map-popover-target"),$=y(),_=b.geo.mercator().scale(j).translate([h/2,g/1.5]),aa=b.geo.path().projection(_),ba=b.select(W[0]).append("svg").attr("preserveAspectRatio","xMidYMid").attr("viewBox","0 0 "+h+" "+g).attr("width",$).attr("height",$*g/h);ba.append("rect").attr("class","water").attr("width",h).attr("height",g).on("click",L);var ca=ba.append("g");n.onContainerClick=L,b.json(n.config.topoUrl,function(a,b){if(a)throw a;U=b,q(),p()}),a(window).resize(w)}}}])}(window.jQuery,window.d3),function(a){"use strict";angular.module("xom.shared").factory("eventBusSvc",function(){return{publish:a.publish,subscribe:a.subscribe}})}(window.jQuery);