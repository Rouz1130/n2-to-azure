/*! 2016-08-23 16:18:28 */
angular.module("list",["ngSanitize","xom.shared"]).config(["$locationProvider",function(a){a.html5Mode(!0)}]),angular.module("list").controller("ListCtrl",["$scope","$window","$location","eventBusSvc","serializationSvc","facetSvc","dataSvc","extenderSvc","LIST",function(a,b,c,d,e,f,g,h,i){"use strict";function j(){var a=c.search(),b={q:"",pageSize:10,pageNumber:1,selectedFacets:""},d=h.extend(b,i.filters,a),e={},f={};d.pageNumber>1&&(f.pageNumber=1,f.pageSize=d.pageSize*d.pageNumber),i.searchOnLoad||(e.deferSearch=!0),a.q||(e.dontUpdateUrl=!0),d.pageNumber=parseInt(d.pageNumber),d.pageSize=parseInt(d.pageSize),k(d,f,e)}function k(b,c,d){var e={deferSearch:!1,replaceResult:!0},f=function(){a.lastSearchPhrase=a.filters.q,q(!1)};angular.extend(a.filters,b),d=angular.extend({},e,d),d.deferSearch||(d.dontUpdateUrl||p(a.filters),angular.extend(a.filters,c),q(!0),a.apiError=null,g.search(a.filters).then(function(a){n(a,d)}).catch(o).finally(f))}function l(){k({pageNumber:a.filters.pageNumber+1},null,{replaceResult:!1})}function m(b,c){b.selected=!b.selected,a.filters.selectedFacets=f.serializeFacets(a.facets),k({pageNumber:1},null,c)}function n(b,c){a.facets=b.facets,f.applyFacetSelections(a.facets,a.filters.selectedFacets),a.totalCount=b.totalCount,c.replaceResult&&(a.results.length=0),Array.prototype.push.apply(a.results,b.results),d.publish("xom.analytics",{cg:"Search",csg:"Search",oss:a.filters.q,ossr:b.totalCount})}function o(b){a.apiError=b}function p(a){c.search(a).replace()}function q(a){d.publish("xom.loading",!!a)}function r(a,b){var c=angular.extend({pageNumber:1},b),d={replaceResult:!0};k(c,null,d)}function s(a){b.location.href=a}function t(a){return v[a.toLowerCase()]}function u(a){v[a.toLowerCase()]=!v[a.toLowerCase()]}var v={};a.facets=[],a.filters={},a.lastSearchPhrase=null,a.listConfig=i,a.results=[],a.totalCount=-1,a.applyFilter=k,a.isFacetOpen=t,a.loadMore=l,a.reloadPage=s,a.toggleFacetOpen=u,a.toggleFacetValue=m,i.eventName&&d.subscribe(i.eventName,r),j()}]),angular.module("list").factory("dataSvc",["$http","$q","httpShimSvc","LIST",function(a,b,c,d){"use strict";function e(e){var f=b.defer(),g=c.parseTemplateUrl(d.apiUrl,e);return g.method="GET",a(g).then(function(a){f.resolve(a.data)},function(a){f.reject("The API returned status code "+a.status)}),f.promise}return{search:e}}]),function(a){a("script[data-app]").each(function(){var b=a(this),c=b.data("app"),d=a.parseJSON(b.html());for(var e in d)angular.module(c).constant(e,d[e])})}(window.jQuery),angular.module("xom.shared",[]),function(a){"use strict";angular.module("xom.shared").factory("eventBusSvc",function(){return{publish:a.publish,subscribe:a.subscribe}})}(window.jQuery),angular.module("xom.shared").service("extenderSvc",function(){"use strict";function a(){if(0===arguments.length||"object"!=typeof arguments[0])return{};for(var a=arguments[0],c=1;c<arguments.length;c++)"object"==typeof arguments[c]&&b(arguments[c],a);return a}function b(a,b){for(var d in a)if(a.hasOwnProperty(d)&&null!==a[d]){var e=c(b,d);b[e]=angular.copy(a[d])}}function c(a,b){var c=b.toLowerCase();for(var d in a)if(d.toLowerCase()===c)return d;return b}return{copyProperties:b,extend:a,getPropertyName:c}}),angular.module("xom.shared").factory("facetSvc",["serializationSvc",function(a){"use strict";function b(a,b,c){var d=h(a,b);if(null!==d){var e=h(d.values,c);return e&&e.selected===!0}}function c(a,b,c){var d=h(a,b);if(null!==d){var e=h(d.values,c);null!==e&&(e.selected=!e.selected)}}function d(a,b){for(var c=0;c<a.length;c++){var d=h(b,a[c].key);if(null!==d)for(var e=0;e<a[c].values.length;e++){var f=h(d.values,a[c].values[e].key);null!==f&&(a[c].values[e].selected=f.selected)}}return a}function e(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=(d.values||[]).filter(g);0!==e.length&&b.push(d.key+":"+e.map(j).join(","))}return b.join("|")}function f(a,b){if(b)for(var c=k(b),d=0;d<a.length;d++){var e=a[d],f=i(c,e.key);if(null!==f&&0!==f.length)for(var g=0;g<e.values.length;g++){var h=e.values[g];h.selected=l(f,h.key)}}}function g(a){return a.selected===!0}function h(a,b){var c=b.toLowerCase(),d=a.filter(function(a){return a.key.toLowerCase()===c});return d.length>0?d[0]:null}function i(a,b){var c=b.toLowerCase();for(var d in a)if(d.toLowerCase()===c)return a[d];return null}function j(a){return a.key}function k(b){var c=a.deserialize(b,"|",":");for(var d in c)null!==c[d]&&(c[d]=c[d].split(","));return c}function l(a,b){var c=b.toLowerCase();return a.filter(function(a){return a.toLowerCase()===c}).length>0}return{applyFacetSelections:f,isFacetValueSelected:b,mergeFacets:d,serializeFacets:e,toggleFacetValue:c}}]),angular.module("xom.shared").factory("httpShimSvc",function(){"use strict";function a(a,b){var c={},d=a;for(var e in b){var f=new RegExp("(&?)([^?&=]+)(={{"+e+"}})(&?)"),g=d.match(f);if(g){c[g[2]]=b[e];var h=g[0];g[1]+g[4]==="&&"&&(h=h.substring(1)),d=d.replace(h,"")}}return{params:c,url:d}}return{parseTemplateUrl:a}}),angular.module("xom.shared").service("serializationSvc",function(){"use strict";function a(a,b,c){var d=[];for(var e in a)a.hasOwnProperty(e)&&null!==a[e]&&""!==a[e]&&d.push(e+c+a[e]);return d.join(b)}function b(a,b,c){var d={},e=new RegExp("([^?"+c+b+"]+)("+c+"([^"+b+"]*))?","g");return a.replace(e,function(a,b,c,e){d[b]=e}),d}return{serialize:a,deserialize:b,toQueryString:function(b){return a(b,"&","=")},fromQueryString:function(a){return b(a,"&","=")}}});