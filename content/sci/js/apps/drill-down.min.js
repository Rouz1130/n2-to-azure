/*! drill-down 2017-09-13 12:04:30 */

angular.module("drill-down",["xom.shared"]),angular.module("drill-down").controller("DrillDownCtrl",["$scope","$http","$interpolate","eventBusSvc","DRILL_DOWN",function(a,b,c,d,e){"use strict";function f(c,d){a.loading||(a.loading=!0,a.list&&!d&&a.breadcrumbs.push(angular.copy(a.list)),b.get(c).then(g,h).finally(i))}function g(b){a.error=null,a.list=b.data.conditionlist,a.list.url=b.config.url,k(a.list),p()}function h(b){a.error=b}function i(){a.loading=!1}function j(b,d){var g=c(e.initialApiUrl),h=g(d);a.breadcrumbs=[],a.list=null,a.previousList=null,f(h)}function k(a){var b=a.results.length,c=l(b),d=m(b,c);a.groups=[];for(var e=0;e<a.results.length;e++)e%d==0&&a.groups.push([]),a.groups[a.groups.length-1].push(a.results[e])}function l(a){for(var b=0;b<e.groupingRules.length;b++)if(e.groupingRules[b].minItems<=a)return e.groupingRules[b].cols;return 3}function m(a,b){var c=parseInt(a/b);return a%b!=0&&c++,c}function n(a,b){return-(a.minItems-b.minItems)}function o(){if(!(a.breadcrumbs.length<1)){f(a.breadcrumbs.pop().url,!0)}}function p(){a.previousList=a.breadcrumbs.length<1?null:a.breadcrumbs[a.breadcrumbs.length-1]}a.breadcrumbs=[],a.error=null,a.list=null,a.loading=!1,a.previousList=null,a.goBack=o,a.loadList=f,a.$watch("loading",function(a){d.publish("xom.loading",a)}),e.groupingRules.sort(n),e.searchOnLoad&&f(e.initialApiUrl),e.phraseEventName&&d.subscribe(e.phraseEventName,j)}]),function(a){a("script[data-app]").each(function(){var b=a(this),c=b.data("app"),d=a.parseJSON(b.html());for(var e in d)angular.module(c).constant(e,d[e])})}(window.jQuery),angular.module("xom.shared",[]),function(a){"use strict";angular.module("xom.shared").factory("eventBusSvc",function(){return{publish:a.publish,subscribe:a.subscribe}})}(window.jQuery);