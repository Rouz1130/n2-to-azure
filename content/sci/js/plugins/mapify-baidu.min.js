/*! 2017-08-29 13:09:43 */

!function(a){"use strict";function b(a){return a.data(j)}function c(a){for(var b=[],c=0;c<a.length;c++){var d=a[c].getPosition();b.push(d)}return b}function d(a,b){var c,d={add:[],remove:[]};for(c=0;c<a.length;c++)e(b,a[c])>=0||d.remove.push(a[c]);for(c=0;c<b.length;c++)f(a,b[c])>=0||d.add.push(b[c]);return d}function e(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b.pin.id)return c;return-1}function f(a,b){for(var c=0;c<a.length;c++)if(a[c].pin.id==b.id)return c;return-1}function g(a,b){var c=b.position,d={lat:c.latitude,lng:c.longitude},e=new BMap.Icon(a.options.pin.image,new BMap.Size(a.options.pin.width,a.options.pin.height)),f=new BMap.Marker(new BMap.Point(d.lng,d.lat),{icon:e});a.bmap.addOverlay(f),a.markers.push(f),f.pin=b,function(b){var c=new BMap.InfoWindow(b.pin.popup,{enableCloseOnClick:!1}),d=function(d){var e=new BMap.Point(d.target.point.lng,d.target.point.lat);a.bmap.openInfoWindow(c,e),"function"==typeof a.onPinOpenedInternal&&a.onPinOpenedInternal(b.pin)};b.addEventListener("click",d)}(f)}function h(a,b){var c=a.markers.indexOf(b);a.markers.splice(c,1),a.bmap.clearOverlays(),a.markers=[]}function i(a,b){a.geocoder=a.geocoder||new BMap.Geocoder,a.geocoder.getPoint(b,function(b){b?a.bmap.centerAndZoom(b,a.options.zoom||16):console.warn("Supplied location could not be geocoded.")})}var j="em.map",k=function(b,c){a(b).addClass("map-baidu"),this.bmap=new BMap.Map(b),this.bmap.addControl(new BMap.NavigationControl),this.bmap.addControl(new BMap.MapTypeControl),this.bmap.centerAndZoom({lat:c.center.latitude,lng:c.center.longitude},c.zoom),this.markers=[],this.options=c};k.TYPE="Baidu",k.VERSION="1.0",k.prototype.setPins=function(a){var c,e=b(this),f=d(e.markers,a);for(c=0;c<f.add.length;c++)g(e,f.add[c]);for(c=0;c<f.remove.length;c++)h(e,f.remove[c])},k.prototype.setBoundaryToPins=function(){var a=b(this),d=c(a.markers);0!==a.markers.length&&a.bmap.setViewport(d)},k.prototype.onBoundaryChanged=function(a){function c(){var b=d.getBounds(),c=b.getSouthWest(),e=b.getNorthEast();if(null!==c&&null!==e){var f={latitude1:e.lat,latitude2:c.lat,longitude1:c.lng,longitude2:e.lng};a(f)}}var d=b(this).bmap;d.addEventListener("moveend",function(){c()}),d.addEventListener("zoomend",function(){c()})},k.prototype.onPinOpened=function(a){b(this).onPinOpenedInternal=a},k.prototype.center=function(a){var c=b(this);"string"==typeof a?i(c,a):"object"==typeof a&&c.bmap.setCenter(new BMap.Point(a.longitude,a.latitude))},k.prototype.zoom=function(a){b(this).bmap.setZoom({zoom:a})};var l=function(b){var c=arguments.length>1?arguments[1]:void 0;return this.each(function(){var d=a(this),e=d.data(j);e||d.data(j,e=new k(this,b)),"string"==typeof b&&"function"==typeof e[b]&&e[b].call(d,c)})};a.fn.mapify=l,a.fn.mapify.Constructor=k}(window.jQuery);